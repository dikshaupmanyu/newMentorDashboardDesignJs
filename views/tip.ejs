

    <%- include partials/innerheader %>

      <div class="app_main">
                  
            <%- include partials/innersidebar %>
        <div class="app_content">
          <div class="dsbrd_container">

   <div class="dashboard_wrapper mentordashboard1_wrapper row">
      <div class="dashboard_wrapper_left col">
       <!--  <div class="post_recent_tips_area">
          <div class="post_tip_head">
            <h2>Recent Tips</h2>
          </div>
          <div class="post_tip_recent_boxes">
            <div class="row" id="demoTipLists">
            </div>
          </div>
        </div> -->
        <div class="post_new_tips_area">
          <div class="post_tip_head">
            <h2>Post New Tips</h2>
          </div>
          <div class="post_new_tips_wrapper">
            <form id="formoid" enctype="multipart/form-data" onsubmit="return false" style="color: white;">
              <div class="post_new_tip_bx post_new_tip_bx1">
                <label>Search Stock</label>
                <div class="search_stock">
                  <!-- <h3>ASGBQ</h3> -->                
                   <input type="text" id="search-box" class="form-control" placeholder="Company Name or Symbol Name" style="text-transform:uppercase;background-color: #06264d;border-color:#06264d;color: white;"/>
                   
                </div>
                 <div class="post_new_tip_bx post_new_tip_bx2">
                      <label></label>
                      <ul id="suggesstion-box">
                      </ul>
                  </div>

               <!--  <h4><span class="round_tag buy_tag"><img src="images/t-logo.png" alt="images"></span> TradeTips AI Trend <span class="color_buy">Buy</span></h4> -->
              </div>
              <!-- <div class="post_new_tip_bx post_new_tip_bx2">
                <label>Signal Type</label>
                <div class="input-group signal_radio_type pymnt_radio_btn">
                  <label class="radio_btn_buy">
                    <input type="radio" name="payment-method" checked>Buy
                    <span class="pymnt_radio"></span>
                  </label>
                  <label class="radio_btn_sell">
                    <input type="radio" name="payment-method">Sell
                    <span class="pymnt_radio"></span>
                  </label>
                </div>
              </div> -->
              <div class="post_new_tip_bx post_new_tip_bx3">
                <div class="row">
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12">
                    <label>Entry Price</label>
                    <div class="price_bx">
                      <img src="images/doller-icon.png" alt="images">
                      <input type="text" class="form-control" id="setEntry" placeholder="Set Entry" readonly="readonly" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" >
                    </div>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12">
                    <label>Enter Stop</label>
                    <div class="price_bx">
                      <img src="images/doller-icon.png" alt="images">
                       <input type="text" class="form-control" id="setStop" placeholder="Set Stop" readonly="readonly" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" >
                    </div>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12">
                    <label>Exit</label>
                    <div class="price_bx">
                      <img src="images/doller-icon.png" alt="images">
                     <input type="text" class="form-control" id="setExit" placeholder="Set Exit" readonly="readonly" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" >
                        <input type="hidden" id="createprice">
                        <input type="hidden" id="loginId">
                    </div>
                  </div>
                </div>
              </div>
              <div class="post_new_tip_bx post_new_tip_bx4">
                <label>Enter Description</label>
                 <textarea class="form-control" id="commentdata" placeholder="Enter Comment"></textarea>
                <h5>Max 200 Characters</h5>
              </div>
              <div class="post_new_tip_bx post_new_tip_bx5">
                <label>Attach Image in Tip</label>
                 <input id="file" type="file" accepts="image/*" /><br />
                    <label for="file"></label><br />
                    <img id="preview" />
              </div>
              <div class="post_new_tip_bx_btn">
                <input type="reset" class="btn cmn_btn btn_primary" value="Cancel">
                <button type="submit" id="datasubmit" class="btn cmn_btn btn_primary">Post Tip</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="dashboard_wrapper_right col">
        <div class="tips_wtlist_head">
          <div class="btn-group select_dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown">My StockList <span class="caret"></span></a>
            <!-- <ul class="dropdown-menu select_dropdown_menu" id="menu">
              <li class="dropdown-item px-2"><a href="#">My Watchlist</a></li>
              <li class="dropdown-item px-2"><a href="#">Free AI tips</a></li>
            </ul> -->
          </div>
         <!--  <span><a href="#">Manage</a></span> -->
        </div>
        <div class="tips_wtlist_items" id="demos">
          
        </div>
      </div>
    </div>

          </div>

        </div>


   <%- include partials/innerfooter %>

<script type="text/javascript">

  var sData = localStorage.getItem('allTokenData');
  var storageData= JSON.parse(sData);
 
  var tokens = storageData.tokendata;
  //alert(tokens);
  var userName = storageData.uname;
  // alert(userName);
  var formdata = {  offset: 0, limit: 1000000};


  $.ajax({
        type: 'POST',
        url: 'https://apis.tradetipsapp.com/api/stockDetail/getAllStockOfUserByUserName?userName='+ userName,
        headers: {
          Authorization: 'Bearer '+ tokens ,
        },
        data: formdata,
      success: function(datas) {
       var dataks = JSON.stringify(datas);
       var dataResults = JSON.parse(dataks); 
       // console.log(dataResults);
       var texts = "" ;
       
       var lens = dataResults.length;

          if(dataResults.length > 0){


               let deletdata = [];

                let users = [];
                for(var i= dataResults.length - 1; i >= 0 ; i--){

                    users.push(dataResults[i].stockSymbol); 
                    deletdata.push(dataResults[i].id);                   

                }

                $.get('https://cloud.iexapis.com/stable/stock/market/batch?types=quote&token=pk_dd324da3fb5f4428a47b05ab12f23ce2&symbols='+ users , function(r) {
                
                   for (k= 0; k< users.length; k ++) {

                    texts += '<div class="tips_wtlist_item"><div class="tips_wtlist_item_left"><h2>'+ r[users[k]].quote.symbol +'<span>'+ r[users[k]].quote.companyName +'</span></h2></div><div class="tips_wtlist_item_center"><h3>$ '+ parseFloat(r[users[k]].quote.latestPrice).toFixed(2) +'</h3> '+ (r[users[k]].quote.change > 0 ? ' </div><div class="tips_wtlist_item_right"><h3><span class="color_buy">'+ parseFloat(r[users[k]].quote.change).toFixed(2) +'</span></h3>':'</div><div class="tips_wtlist_item_right"><h3><span class="color_sell">'+ parseFloat(r[users[k]].quote.change).toFixed(2) +'</span></h3>')+'</div></div>';


                   }

    
                   $("#demos").append(texts);  

                }); 

                  

              } 

            
            
          
      
       }
       
  });


  // $.ajax({
  //       type: 'POST',
  //       url: 'https://apis.tradetipsapp.com/api/tip/getAllTipsWithoutCommentsPagination',
  //       headers: {
  //         Authorization: 'Bearer '+ tokens ,
  //       },
  //       data: formdata,
  //     success: function(datastip) {
  //      var datatips = JSON.stringify(datastip);
  //      var dataResultTips = JSON.parse(datatips); 
  //      // alert(dataResultTips.length);
  //     // alert(dataResultTips.length-5);
  //      var tipslist = "" ;


  //         if(dataResultTips.length > 0){


  //                  for(var i= dataResultTips.length - 4; i < dataResultTips.length ; i++) {



  //                   tipslist += '<div class="col"><div class="post_tip_recent_bx sell_bg"><div class="tips_bx_cmpny_name"><span class="bs_btn sell_btn">Sell</span><h2>'+ dataResultTips[i].stockName +' <span>'+ new Date(dataResultTips[i].createdOn).toDateString() +'</span></h2></div><ul><li>Entry <span>'+ parseFloat(dataResultTips[i].entryPoint).toFixed(2) +'</span></li><li>Exit <span class="color_sell">'+ parseFloat(dataResultTips[i].exitPoint).toFixed(2) +'</span></li><li>Stop <span>'+ parseFloat(dataResultTips[i].stopPoint).toFixed(2) +'</span></li></ul></div></div>';


  //                  }

    
  //                  $("#demoTipLists").append(tipslist);  
                  

  //             }     
          
      
  //      }
       
  // });


  $("#formoid").submit(function(event){

    // alert("function 3");
  var stockName = $('#search-box').val();
  // alert(stockName);
  var userids = userids;
  var entryPoint = $('#setEntry').val();
  // alert(entryPoint);
  var exitPoint = $('#setExit').val();
  // alert(exitPoint);
  var stopPoint = $('#setStop').val();
  // alert(stopPoint);
  var tipComment = $('#commentdata').val();
  var imageDetails = $('#image').val();
  var status = "Pending";
  var timeFrame = "15 days";
  var stockSuggestion;
  var createTipPrice = $('#createprice').val();
  
//   $("input[type=file]").on("change", function() {
//   $("[for=file]").html(this.files[0].name);
//   alert(URL.createObjectURL(this.files[0]));
// });
  
  var file = document.getElementById("file").files[0];
  // alert(file);
  var fullPath = $("#file").val();    
  var filename = fullPath.replace(/^.*[\\\/]/, '');
  // alert(filename);

  if(entryPoint == exitPoint || entryPoint == stopPoint){

      alert("Your entryPoint or exitPoint will not be same");


  }else{

    var formdata = new FormData();

    if(entryPoint < exitPoint) {

         // alert("Buy");

      formdata.append("stockSuggestion", "Buy");

    } else if(entryPoint > exitPoint) {

        // alert("Sell");

      formdata.append("stockSuggestion", "Sell");

  
    } else {

      formdata.append("stockSuggestion", "Avoid");

    }

    formdata.append("tipComment", tipComment);
    formdata.append("entryPoint", entryPoint);
    formdata.append("exitPoint", exitPoint);
    formdata.append("stopPoint", stopPoint);
    formdata.append("stockName", stockName);
    formdata.append("status", "Approved");
    // formdata.append("imageDetails", "/path/to/file");

    if(filename == ""){
    // alert("null");
      formdata.append("imageDetails", "");

    }else{
    // alert("not null");
      formdata.append("imageDetails", file , filename);

    }
    formdata.append("timeFrame", "15 days");
    formdata.append("createTipPrice", createTipPrice);
    formdata.append("userId", userids);

    // alert("tip add");

    var requestOptions = {
      method: 'POST',
      headers: {
              Authorization: 'Bearer '+ tokens
            },
      body: formdata,
      redirect: 'follow'
    };

    // alert("neww");

    fetch("https://apis.tradetipsapp.com/api/tip/addTip", requestOptions)
      .then(response => response.json())
      .then(result => {

                var datak = JSON.stringify(result);
                // alert(datak);
                var dataResultp = JSON.parse(datak); 
                // alert(dataResultp.stockName);
                alert("Your tip for "+dataResultp.stockName+" was submitted successfully");
                window.location.reload();

       })
      .catch(error => console.log('error', error));


  }

  });


   
var timer;

$(document).ready(function(){


    $("#search-box").keyup(function(){
        // alert($(this).val());
      // alert("timeset");

     clearTimeout(timer);

    timer = setTimeout(() => {
          // alert("timeout");
          // alert($(this).val());
        $.ajax({
        type: "POST",
        url: "https://apis.tradetipsapp.com/api/stocksearchdetails/searchStockSymbol",
        data:'stockSymbol='+$(this).val(),
        headers: { Authorization: 'Bearer '+ tokens},
        beforeSend: function(){
            // $("#search-box").css("background","#FFF url(LoaderIcon.gif) no-repeat 165px");
             $("#suggesstion-box").css("overflow-y", "none");
             // clearTimeout(timer);

        },
        success: function(data){
            // alert(data);

           var datak = JSON.stringify(data);
           var dataResult = JSON.parse(datak);
           var len = dataResult.length;
           // alert(len);
          
      
            // $("#suggesstion-box").show();
              $("#suggesstion-box").css("overflow-y", "scroll");
              $("#suggesstion-box").css("height", "200px");
              $("#suggesstion-box").empty();

                  
                  clearTimeout(timer);
             
                 for( var i = 0; i<len; i++){
                    // alert(len);
                    var id = dataResult[i]['id'];
                    var symbol = dataResult[i]['stockSymbol'];
                    var name = dataResult[i]['stockName'];
                     // alert(name);

                     clearTimeout(timer);  

                    $("#suggesstion-box").append("<li style='    list-style: none;' value='"+symbol+"'><input id='radiobtn"+symbol+"' type='radio' name='symbolName' value='"+symbol+"'>&nbsp;"+symbol+"</li>");

                    clearTimeout(timer);

                    $(':radio[name="symbolName"]').change(function(){
                        $(this).parent('li').addClass('selected').siblings().removeClass('selected');

                    }).filter(':checked').change();   


                }

                   
                $('input:radio[name="symbolName"]').click(function () {
                    // alert("hi");
                    // alert($(this).val());

                    var dataset = $(this).val();

                    // alert(dataset);

                     document.getElementById("setEntry").readOnly  = false;
                    document.getElementById("setStop").readOnly  = false;
                     document.getElementById("setExit").readOnly  = false;
                     document.getElementById("search-box").readOnly  = true;

                    var url = "https://cloud.iexapis.com/stable/stock/market/batch?token=pk_dd324da3fb5f4428a47b05ab12f23ce2&types=quote&symbols="+dataset;
                          $.ajax({
                            url : url,
                            type: "GET",
                            success: function(data)
                            {
                                     // alert(data[symbol]);

                                document.getElementById("search-box").value  = dataset;

                                 document.getElementById("setEntry").value = JSON.stringify(data[dataset].quote.latestPrice);
                                 document.getElementById("setStop").value = JSON.stringify(data[dataset].quote.latestPrice);
                                 document.getElementById("setExit").value = JSON.stringify(data[dataset].quote.latestPrice);
                                  document.getElementById("createprice").value = JSON.stringify(data[dataset].quote.latestPrice);
                              
                            }

                          });
                });
     
                             
        }
        });
         }  , 1000 );
    });
});




</script>